{{ define "main" }}

<article class="article" itemscope itemtype="https://schema.org/Article">

    {{/* Article Header */}}
    <header class="article-header">
        <div class="header-content">

            {{/* Series Badge */}}
            {{ with .Params.series }}
            {{ $seriesName := index . 0 }}
            {{ $seriesPages := where $.Site.RegularPages "Params.series" "intersect" (slice $seriesName) }}
            {{ $seriesPages = $seriesPages.ByParam "series_weight" }}
            {{ $currentIndex := 0 }}
            {{ range $index, $page := $seriesPages }}
                {{ if eq $page.Permalink $.Permalink }}
                    {{ $currentIndex = add $index 1 }}
                {{ end }}
            {{ end }}
            <a href="{{ "/series/" | relLangURL }}{{ $seriesName | urlize }}/" class="article-series-badge">
                <span class="series-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                    </svg>
                </span>
                {{ $seriesName }} Â· Part {{ $currentIndex }} of {{ len $seriesPages }}
            </a>
            {{ end }}

            {{/* Category */}}
            {{ with .Params.categories }}
            <p class="article-category">
                {{ range first 1 . }}
                <a href="{{ "/categories/" | relLangURL }}{{ . | urlize }}/" rel="category">{{ . }}</a>
                {{ end }}
            </p>
            {{ end }}

            {{/* Title */}}
            <h1 class="article-title" itemprop="headline">{{ .Title }}</h1>

            {{/* Subtitle / Description */}}
            {{ with .Params.subtitle | default .Description }}
            <p class="article-subtitle" itemprop="description">{{ . }}</p>
            {{ end }}

            {{/* Meta Information */}}
            <div class="article-meta">
                {{/* Author */}}
                {{ with .Params.author | default .Site.Params.author }}
                <span class="meta-item article-author" itemprop="author" itemscope itemtype="https://schema.org/Person">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                    </svg>
                    <span itemprop="name">{{ . }}</span>
                </span>
                {{ end }}

                {{/* Date - only show if date is set (not year 0001) */}}
                {{ if gt .Date.Year 1 }}
                <span class="meta-item">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
                    </svg>
                    <time datetime="{{ .Date.Format "2006-01-02" }}" itemprop="datePublished">
                        {{ .Date.Format "2 January 2006" }}
                    </time>
                </span>

                {{/* Last Modified Date - show if different from publish date */}}
                {{ if and .Params.lastmod (ne (.Params.lastmod.Format "2006-01-02") (.Date.Format "2006-01-02")) }}
                <span class="meta-item article-meta-updated" title="Last updated">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                    </svg>
                    <time datetime="{{ .Params.lastmod.Format "2006-01-02" }}" itemprop="dateModified">
                        Updated {{ .Params.lastmod.Format "2 January 2006" }}
                    </time>
                </span>
                {{ end }}

                {{/* Reading Time - only show for dated content */}}
                <span class="meta-item">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span class="reading-time-value">{{ partial "reading-time.html" . }} minute read</span>
                </span>
                {{ end }}
            </div>

        </div>
    </header>

    {{/* Featured Image */}}
    {{ with .Params.featured_image }}
    <div class="article-featured-image">
        <figure>
            {{ partial "picture.html" (dict "src" . "alt" ($.Params.featured_image_alt | default $.Title) "class"
            "featured-image") }}
            {{ with $.Params.featured_image_caption }}
            <figcaption>{{ . | markdownify }}</figcaption>
            {{ end }}
        </figure>
    </div>
    {{ end }}

    {{/* Series Navigation (top) */}}
    {{ with .Params.series }}
    <div class="article-series-nav">
        {{ partial "series-nav.html" $ }}
    </div>
    {{ end }}

    {{/* Corrections and Updates */}}
    {{ partial "corrections.html" . }}

    {{/* Article Content */}}
    <div class="article-content" itemprop="articleBody">
        {{ partial "toc.html" . }}
        {{ .Content }}
    </div>

    {{/* Article Footer */}}
    <footer class="article-footer">

        {{/* Tags */}}
        {{ with .Params.tags }}
        <div class="article-tags" itemprop="keywords">
            {{ range . }}
            <a href="{{ "/tags/" | relLangURL }}{{ . | urlize }}/" class="tag" rel="tag">{{ . }}</a>
            {{ end }}
        </div>
        {{ end }}

        {{/* Author Bio (if defined in data) */}}
        {{ with .Params.author }}
        {{ $authorData := index $.Site.Data.authors . }}
        {{ if $authorData }}
        <div class="article-author-bio">
            {{ with $authorData.avatar }}
            <img src="{{ . }}" alt="{{ $authorData.name }}" class="author-avatar">
            {{ end }}
            <div class="author-info">
                <h4>{{ $authorData.name }}</h4>
                {{ with $authorData.bio }}<p>{{ . }}</p>{{ end }}
            </div>
        </div>
        {{ end }}
        {{ end }}

        {{/* Share Buttons */}}
        {{ partial "share.html" . }}

    </footer>

    {{/* Series Navigation (bottom) */}}
    {{ with .Params.series }}
    <div class="article-series-nav article-series-nav-bottom">
        {{ partial "series-nav.html" $ }}
    </div>
    {{ end }}

    {{/* Related Articles */}}
    <div class="article-related">
        {{ partial "related.html" . }}
    </div>

</article>

{{ end }}